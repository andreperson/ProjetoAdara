@model Domain.ModelView.IndexModelView

@{
    ViewBag.Title = "Adarana";
}



@section Scripts {

<script src="/assets/js/plugins/chart.js/dist/Chart.min.js"></script>
<script src="/assets/js/plugins/chart.js/dist/Chart.extension.js"></script>

    <script type="text/javascript">
        //load

        //
        // Orders chart
        //


        $(document).ready(function () {



            //listaJobs();
            FillGraphMonth();

        });



        function listaJobs(projectid) {
            $.getJSON('@Url.Action("ListaJobs/")' + projectid, FillGraphMonth);
        }

      

        function FillGraphMonth()
        {
           

            var OrdersChart = (function () {

                //
                // Variables
                //

                var $chart = $('#chart-orders');
                var $ordersSelect = $('[name="ordersSelect"]');


                //
                // Methods
                //

                // Init chart
                function initChart($chart) {

                    // Create chart
                    var ordersChart = new Chart($chart, {
                        type: 'bar',
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        callback: function (value) {
                                            if (!(value % 10)) {
                                                //return '$' + value + 'k'
                                                return value
                                            }
                                        }
                                    }
                                }]
                            },
                            tooltips: {
                                callbacks: {
                                    label: function (item, data) {
                                        var label = data.datasets[item.datasetIndex].label || '';
                                        var yLabel = item.yLabel;
                                        var content = '';

                                        if (data.datasets.length > 1) {
                                            content += '<span class="popover-body-label mr-auto">' + label + '</span>';
                                        }

                                        content += '<span class="popover-body-value">' + yLabel + '</span>';

                                        return content;
                                    }
                                }
                            }
                        },
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                            datasets: [{
                                label: 'Sales',
                                data: [@ViewBag.Jan, @ViewBag.Fev, @ViewBag.Mar, @ViewBag.Abr, @ViewBag.Mai, @ViewBag.Jun, @ViewBag.Jul, @ViewBag.Ago, @ViewBag.Set, @ViewBag.Out, @ViewBag.Nov, @ViewBag.Dez]
                            }]
                        }
                    });

                    // Save to jQuery object
                    $chart.data('chart', ordersChart);
                }


                // Init chart
                if ($chart.length) {
                   
        
                        initChart($chart);
                }

            })();
        }


        //
        // Charts
        //





        function GetTotalClientes() {
            $.getJSON('@Url.Action("GetTotalVendasByClientes/")', GetTotalClientesCallBack);
        }

        function GetTotalClientesCallBack(json) {
            $("#ttclientes").html(json);
        }

        function GetTotalRecebidas() {
            $.getJSON('@Url.Action("GetTotalRecebidas/")', GetTotalRecebidasCallBack);
        }

        function GetTotalRecebidasCallBack(json) {
            $("#ttrecebidas").html(json);
        }

        function GetTotalFechadas() {
            $.getJSON('@Url.Action("GetTotalFechadas/")', GetTotalFechadasCallBack);
        }

        function GetTotalFechadasCallBack(json) {
            $("#ttfechadas").html(json);
        }


        function GetTotalVendas() {
            $.getJSON('@Url.Action("GetTotalVendas/")', GetTotalVendasCallBack);
        }

        function GetTotalVendasCallBack(json) {
            $("#ttvendas").html(json);
        }

        function GetVendas(id) {
            $.getJSON('@Url.Action("GetVendas/")' + id, GetVendasCallBack);
        }

        function GetVendasCallBack(json) {
            var lstMesFec = [];
            var lstValorFec = [];
            var mes = "";

            var lstMesRec = [];
            var lstValorRec = [];

            var month = new Array();
            month[0] = "";
            month[1] = "Janeiro";
            month[2] = "Fevereiro";
            month[3] = "Março";
            month[4] = "Abril";
            month[5] = "Maio";
            month[6] = "Junho";
            month[7] = "Julho";
            month[8] = "Agosto";
            month[9] = "Setembro";
            month[10] = "Outubro";
            month[11] = "Novembro";
            month[12] = "Dezembro";


            var d = new Date();

            var matual = d.getMonth() + 1;
            var mat = month[matual];

            $("#mesatual").html(mat);

            $.each(json, function () {
                $.each(this, function (name, value) {
                    //alert(value.nome + " " + value.descr + " " + value.soma);
                    if (value.nome == "fec") {
                        mes = month[value.descr];
                        lstMesFec.push(mes);
                        lstValorFec.push(value.soma);
                    }
                    else {
                        lstValorRec.push(value.soma);
                    }
                });
            });

            var areaChartData = {
                labels: lstMesFec,
                datasets: [
                  {
                      label: "Compras",
                      fillColor: "rgba(210, 214, 222, 1)",
                      strokeColor: "rgba(210, 214, 222, 1)",
                      pointColor: "rgba(210, 214, 222, 1)",
                      pointStrokeColor: "#c1c7d1",
                      pointHighlightFill: "#fff",
                      pointHighlightStroke: "rgba(220,220,220,1)",
                      data: lstValorFec
                  },
                  {
                      label: "Recebimentos",
                      fillColor: "rgba(60,141,188,0.9)",
                      strokeColor: "rgba(60,141,188,0.8)",
                      pointColor: "#3b8bba",
                      pointStrokeColor: "rgba(60,141,188,1)",
                      pointHighlightFill: "#fff",
                      pointHighlightStroke: "rgba(60,141,188,1)",
                      data: lstValorRec
                  }
                ]
            };


            var areaChartOptions = {
                //Boolean - If we should show the scale at all
                showScale: true,
                //Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines: true,
                //String - Colour of the grid lines
                scaleGridLineColor: "rgba(0,0,0,.05)",
                //Number - Width of the grid lines
                scaleGridLineWidth: 1,
                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,
                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,
                //Boolean - Whether the line is curved between points
                bezierCurve: true,
                //Number - Tension of the bezier curve between points
                bezierCurveTension: 0.3,
                //Boolean - Whether to show a dot for each point
                pointDot: true,
                //Number - Radius of each point dot in pixels
                pointDotRadius: 4,
                //Number - Pixel width of point dot stroke
                pointDotStrokeWidth: 1,
                //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
                pointHitDetectionRadius: 20,
                //Boolean - Whether to show a stroke for datasets
                datasetStroke: true,
                //Number - Pixel width of dataset stroke
                datasetStrokeWidth: 2,
                //Boolean - Whether to fill the dataset with a color
                datasetFill: true,
                //String - A legend template
                legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>",
                //Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
                maintainAspectRatio: true,
                //Boolean - whether to make the chart responsive to window resizing
                responsive: true
            };

            //Create the line chart
            //areaChart.Line(areaChartData, areaChartOptions);


            //-------------
            //- BAR CHART -
            //-------------
            var barChartCanvas = $("#barChart").get(0).getContext("2d");
            var barChart = new Chart(barChartCanvas);
            var barChartData = areaChartData;
            barChartData.datasets[1].fillColor = "#00a65a";
            barChartData.datasets[1].strokeColor = "#00a65a";
            barChartData.datasets[1].pointColor = "#00a65a";
            var barChartOptions = {
                //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
                scaleBeginAtZero: true,
                //Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines: true,
                //String - Colour of the grid lines
                scaleGridLineColor: "rgba(0,0,0,.05)",
                //Number - Width of the grid lines
                scaleGridLineWidth: 1,
                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,
                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,
                //Boolean - If there is a stroke on each bar
                barShowStroke: true,
                //Number - Pixel width of the bar stroke
                barStrokeWidth: 2,
                //Number - Spacing between each of the X value sets
                barValueSpacing: 5,
                //Number - Spacing between data sets within X values
                barDatasetSpacing: 1,
                //String - A legend template
                legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].fillColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>",
                //Boolean - whether to make the chart responsive
                responsive: true,
                maintainAspectRatio: true
            };

            barChartOptions.datasetFill = false;
            barChart.Bar(barChartData, barChartOptions);



        }


    </script>
}

    <!-- Top navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
        <div class="container-fluid">
            <!-- Brand -->
            <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="@Domain.Util.config.UrlSite/">Dashboard</a>
            <!-- Form -->
            <form class="navbar-search navbar-search-dark form-inline mr-3 d-none d-md-flex ml-lg-auto">
                <div class="form-group mb-0">
                    @*<div class="input-group input-group-alternative">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                        </div>
                        <input class="form-control" placeholder="Search" type="text">
                    </div>*@
                </div>
            </form>
            <!-- User -->
            <ul class="navbar-nav align-items-center d-none d-md-flex">
                <li class="nav-item dropdown">
                    <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="media align-items-center">
                            <span class="avatar avatar-sm rounded-circle">
                                <img alt="Image placeholder" src="@Domain.Util.config.UrlImg/usuario/@Html.Action("ImagemHeader", "LayoutMenu")">
                            </span>
                            <div class="media-body ml-2 d-none d-lg-block">
                                <span class="mb-0 text-sm  font-weight-bold">@Html.Action("ApelidoHeader", "LayoutMenu")</span>
                            </div>
                        </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
                        <div class=" dropdown-header noti-title">
                            <h6 class="text-overflow m-0">Welcome!</h6>
                        </div>
                        <a href="@Domain.Util.config.UrlSite/Profile/Perfil/@ViewBag.menuprofileid/@ViewBag.subprofile" title="Profile" class="dropdown-item">
                            <i class="ni ni-single-02"></i>
                            <span>My profile</span>
                        </a>
                        <a href="@Domain.Util.config.UrlSite/WorkProfile/JobProfile/@ViewBag.menuprofileid/@ViewBag.subjob" title="Jobs" class="dropdown-item">
                            <i class="ni ni-calendar-grid-58"></i>
                            <span>My Jobs</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="@Domain.Util.config.UrlSite/Home/Logout/" title="Logout" class="dropdown-item">
                            <i class="ni ni-user-run"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8">
        <div class="container-fluid">
            <div class="header-body">
                <!-- Card stats -->
                <div class="row">
                    <div class="col-xl-3 col-lg-6">
                        <div class="card card-stats mb-4 mb-xl-0">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h5 class="card-title text-uppercase text-muted mb-0">@ViewBag.Descr0</h5>
                                        <span class="h2 font-weight-bold mb-0">@ViewBag.Total0</span>
                                    </div>
                                    <div class="col-auto">
                                        <div class="icon icon-shape bg-danger text-white rounded-circle shadow">
                                            <img src="~/Images/icone/@ViewBag.Img0" width="40" />
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 mb-0 text-muted text-sm">
                                    <span class="text-success mr-2"> @ViewBag.Porc0</span>
                                    <span class="text-nowrap">Currently</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6">
                        <div class="card card-stats mb-4 mb-xl-0">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h5 class="card-title text-uppercase text-muted mb-0">@ViewBag.Descr1</h5>
                                        <span class="h2 font-weight-bold mb-0">@ViewBag.Total1</span>
                                    </div>
                                    <div class="col-auto">
                                        <div class="icon icon-shape bg-warning text-white rounded-circle shadow">
                                            <img src="~/Images/icone/@ViewBag.Img1" width="40" />
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 mb-0 text-muted text-sm">
                                    <span class="text-danger mr-2"> @ViewBag.Porc1</span>
                                    <span class="text-nowrap">Currently</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6">
                        <div class="card card-stats mb-4 mb-xl-0">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h5 class="card-title text-uppercase text-muted mb-0">@ViewBag.Descr2</h5>
                                        <span class="h2 font-weight-bold mb-0">@ViewBag.Total2</span>
                                    </div>
                                    <div class="col-auto">
                                        <div class="icon icon-shape bg-yellow text-white rounded-circle shadow">
                                            <img src="~/Images/icone/@ViewBag.Img2" width="40" />
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 mb-0 text-muted text-sm">
                                    <span class="text-warning mr-2"> @ViewBag.Porc2</span>
                                    <span class="text-nowrap">Currently</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6">
                        <div class="card card-stats mb-4 mb-xl-0">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h5 class="card-title text-uppercase text-muted mb-0">@ViewBag.Descr3</h5>
                                        <span class="h2 font-weight-bold mb-0">@ViewBag.Total3</span>
                                    </div>
                                    <div class="col-auto">
                                        <div class="icon icon-shape bg-default text-white rounded-circle shadow">
                                            <img src="~/Images/icone/@ViewBag.Img3" width="40" />
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 mb-0 text-muted text-sm">
                                    <span class="text-success mr-2"> @ViewBag.Porc3</span>
                                    <span class="text-nowrap">Currently</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--7">
        <div class="row">
           
            <div class="card">
               
            </div>


            <div class="col-xl-12">
                <div class="card shadow">
                    <div class="card-header bg-transparent">
                        <div class="row align-items-center">
                            <div class="col">
                                <h6 class="text-uppercase text-muted ls-1 mb-1">Performance</h6>
                                <h2 class="mb-0">Total jobs</h2>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <!-- Chart wrapper -->
                            <canvas id="chart-orders" class="chart-canvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-xl-12 mb-5 mb-xl-0">
                <div class="card shadow">
                    <div class="card-header border-0">
                        <div class="row align-items-center">
                            <div class="col">
                                <h3 class="mb-0">Last jobs</h3>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <!-- Projects table -->
                        <table class="table align-items-center table-flush">
                            <thead class="thead-light">
                                <tr>
                                    <th scope="col">ProjectId</th>
                                    <th scope="col">JobId</th>
                                    <th scope="col">Matched</th>
                                    <th scope="col">Word Count</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Update Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    double resultado = 0;
                                    string img = "";
                                }
                                @foreach (var item in Model.Jobs)
                                {
                                   img = "ico-status-" + item.jobstatusid + ".png";

                                    resultado = item.qtdepalavrajob * item.valorporpalavrajob;
                                    <tr>
                                        <th scope="row">
                                            @item.projetoid
                                        </th>
                                        <th>
                                            @item.jobid
                                        </th>
                                        <th>
                                            @item.Fuzzie.descricao
                                        </th>
                                        <td>
                                            @item.qtdepalavrajob
                                        </td>
                                        <td>
                                            <img src='@Domain.Util.config.UrlImg/icone/@img' width='15' title='" + @item.JobStatus.descricao + "'> @item.JobStatus.descricao
                                        </td>
                                        <td>
                                            @item.Dataalt
                                        </td>

                                    </tr>
                                }
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
            
        </div>
        <!-- Footer -->
        @*<footer class="footer">
            <div class="row align-items-center justify-content-xl-between">
                <div class="col-xl-6">
                    <div class="copyright text-center text-xl-left text-muted">
                        &copy; 2018 <a href="https://www.creative-tim.com" class="font-weight-bold ml-1" target="_blank">Creative Tim</a>
                    </div>
                </div>
                <div class="col-xl-6">
                    <ul class="nav nav-footer justify-content-center justify-content-xl-end">
                        <li class="nav-item">
                            <a href="https://www.creative-tim.com" class="nav-link" target="_blank">Creative Tim</a>
                        </li>
                        <li class="nav-item">
                            <a href="https://www.creative-tim.com/presentation" class="nav-link" target="_blank">About Us</a>
                        </li>
                        <li class="nav-item">
                            <a href="http://blog.creative-tim.com" class="nav-link" target="_blank">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a href="https://github.com/creativetimofficial/argon-dashboard/blob/master/LICENSE.md" class="nav-link" target="_blank">MIT License</a>
                        </li>
                    </ul>
                </div>
            </div>
        </footer>*@
        <p>&nbsp;</p>
    </div>
